generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model List {
  id              String        @id @db.Char(16)
  name            String        @db.VarChar(64)
  color           Color
  description     String?       @db.Text
  hasTimeTracking Boolean       @default(true)
  hasDueDates     Boolean       @default(true)
  isAutoOrdered   Boolean       @default(true)
  members         ListMember[]
  sections        ListSection[]
  tags            Tag[]
}

model ListSection {
  id     String @id @db.Char(16)
  listId String @db.Char(16)
  name   String @db.VarChar(64)
  items  Item[]
  list   List   @relation(fields: [listId], references: [id], onDelete: Cascade)

  @@index([listId])
}

model Item {
  id            String         @id @db.Char(16)
  name          String         @db.VarChar(128)
  status        Status         @default(Unstarted)
  priority      Priority       @default(Low)
  isUnclear     Boolean        @default(false)
  expectedMs    Int?
  elapsedMs     Int            @default(0)
  parentId      String?        @db.Char(16)
  sectionId     String         @db.Char(16)
  sectionIndex  Int            @default(0)
  dateCreated   DateTime       @default(now()) @db.DateTime(0)
  dateDue       DateTime?      @db.DateTime(0)
  dateStarted   DateTime?      @db.DateTime(0)
  dateCompleted DateTime?      @db.DateTime(0)
  parent        Item?          @relation("family", fields: [parentId], references: [id], onDelete: Cascade)
  children      Item[]         @relation("family")
  section       ListSection    @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  assignees     ItemAssignee[]
  tags          Tag[]          @relation("ItemToTag")

  @@unique([sectionId, parentId, sectionIndex])
  @@index([sectionId])
  @@index([parentId])
}

model Tag {
  id     String @id @db.Char(16)
  name   String @db.VarChar(32)
  color  Color
  listId String @db.Char(16)
  list   List   @relation(fields: [listId], references: [id], onDelete: Cascade)
  items  Item[] @relation("ItemToTag")

  @@index([listId])
}

model ListMember {
  userId      String  @db.Char(191)
  listId      String  @db.Char(16)
  canAdd      Boolean @default(false)
  canRemove   Boolean @default(false)
  canComplete Boolean @default(false)
  canAssign   Boolean @default(false)
  list        List    @relation(fields: [listId], references: [id], onDelete: Cascade)
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, listId])
  @@index([listId])
}

model ItemAssignee {
  userId String @db.Char(191)
  itemId String @db.Char(16)
  role   String @db.VarChar(64)
  item   Item   @relation(fields: [itemId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, itemId])
  @@index([itemId])
}

model Account {
  id                    String    @id
  accountId             String    @db.Text
  providerId            String    @db.Text
  userId                String
  accessToken           String?   @db.Text
  refreshToken          String?   @db.Text
  idToken               String?   @db.Text
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?   @db.Text
  password              String?   @db.Text
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  User                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime
  ipAddress String?  @db.Text
  userAgent String?  @db.Text
  userId    String
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model User {
  id              String         @id @db.VarChar(191)
  name            String         @unique @db.VarChar(32)
  email           String         @unique @db.VarChar(128)
  legacyPassword  String?        @db.Char(205)
  color           User_color
  image           String?        @db.Text
  emailVerified   Boolean        @default(false)
  createdAt       DateTime       @default(now()) @db.DateTime(0)
  updatedAt       DateTime
  username        String?        @unique @db.VarChar(32)
  displayUsername String?        @unique @db.VarChar(32)
  Account         Account[]
  assignedItems   ItemAssignee[]
  memberships     ListMember[]
  Session         Session[]
}

model Verification {
  id         String   @id
  identifier String   @db.Text
  value      String   @db.Text
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@index([identifier(length: 191)])
}

enum Color {
  Pink
  Red
  Orange
  Amber
  Yellow
  Lime
  Green
  Emerald
  Cyan
  Blue
  Violet
}

enum Priority {
  High
  Medium
  Low
}

enum Status {
  Unstarted
  In_Progress
  Paused
  Completed
}

enum User_color {
  Pink
  Red
  Orange
  Amber
  Yellow
  Lime
  Green
  Emerald
  Cyan
  Blue
  Violet
}
