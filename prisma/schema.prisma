datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}


enum Color {
  Pink
  Red
  Orange
  Amber
  Yellow
  Lime
  Green
  Emerald
  Cyan
  Blue
  Violet
}

enum Priority {
  High
  Medium
  Low
}

enum Status {
  Unstarted
  In_Progress @map("In Progress")
  Paused
  Completed
}


model User {
  id            String   @id @db.Char(16)
  username      String   @db.VarChar(32)
  email         String   @db.VarChar(128)
  password      String   @db.Char(205)
  color         Color
  dateCreated   DateTime @db.DateTime(0)
  dateSignedIn  DateTime @default(now()) @db.DateTime(0)

  itemAssignees ItemAssignee[]
  listMembers   ListMember[]
  sessions      Session[]
}

model Session {
  id         String   @id @db.Char(128)
  user_id    String   @db.Char(16)
  dateExpire DateTime @db.DateTime(0)
  
  user      User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([user_id])
}

model List {
  id              String         @id @db.Char(16)
  name            String         @db.VarChar(64)
  color           Color
  description     String?        @db.Text
  hasTimeTracking Boolean        @default(true)
  hasDueDates     Boolean        @default(true)
  isAutoOrdered   Boolean        @default(true)

  listMembers     ListMember[]
  listSections    ListSection[]
  tags            Tag[]
}

model ListSection {
  id      String  @id @db.Char(16)
  list_id String  @db.Char(16)
  name    String  @db.VarChar(64)

  items   Item[]
  list    List    @relation(fields: [list_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([list_id])
}

model Item {
  id            String           @id @db.Char(16)
  name          String           @db.VarChar(128)
  status        Status           @default(Unstarted)
  priority      Priority         @default(Low)
  isUnclear     Boolean          @default(false)
  expectedMs    Int?
  elapsedMs     Int              @default(0)
  parent_id     String?          @db.Char(16)
  section_id    String           @db.Char(16)
  sectionIndex  Int              @default(0)
  dateCreated   DateTime         @default(now()) @db.DateTime(0)
  dateDue       DateTime?        @db.DateTime(0)
  dateStarted   DateTime?        @db.DateTime(0)
  dateCompleted DateTime?        @db.DateTime(0)

  children      Item[]           @relation("family")
  itemAssignees ItemAssignee[]
  tags          Tag[]
  parent        Item?            @relation("family", fields: [parent_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  section       ListSection      @relation(fields: [section_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([section_id])
  @@index([parent_id])
}

model Tag {
  id       String    @id @db.Char(16)
  name     String    @db.VarChar(32)
  color    Color
  list_id  String    @db.Char(16)

  items    Item[]
  list     List      @relation(fields: [list_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([list_id])
}

model ListMember {
  user_id     String  @db.Char(16)
  list_id     String  @db.Char(16)
  canAdd      Boolean @default(false)
  canRemove   Boolean @default(false)
  canComplete Boolean @default(false)
  canAssign   Boolean @default(false)

  user        User    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  list        List    @relation(fields: [list_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@id([user_id, list_id])
  @@index([list_id])
}

model ItemAssignee {
  user_id String @db.Char(16)
  item_id String @db.Char(16)
  ia_role String @db.VarChar(64)

  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  item    Item   @relation(fields: [item_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@id([user_id, item_id])
  @@index([item_id])
}
